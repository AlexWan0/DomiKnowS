version: v1.0
name: Relational Graph
agent:
  machine:
    type: e1-standard-4
    os_image: ubuntu1804
global_job_config:
  prologue:
    commands:
      - checkout
blocks:
  - name: Unit tests
    task:
      prologue:
        commands:
          - sem-version python 3.7
          - 'export PATH=$HOME/.local/bin:$PATH'
          - checkout
          - mkdir .pip_cache
          - 'cache restore pip-$SEMAPHORE_GIT_BRANCH-$(checksum requirements.txt),pip-$SEMAPHORE_GIT_BRANCH,pip-master'
          - 'if [ -e requirements-dev.txt ]; then pip install --cache-dir .pip_cache -r requirements-dev.txt; fi'
          - 'if [ -e requirements.txt ]; then pip install --cache-dir .pip_cache -r requirements.txt; fi'
          - cache store pip-$SEMAPHORE_GIT_BRANCH-$(checksum requirements.txt) .pip_cache
          - 'export PYTHONPATH=.:$PYTHONPATH'
          - export REGR_SOLVER=
      jobs:
        - name: examples
          commands:
            - cd examples/WIQA/
            - python WIQA_aug.py
