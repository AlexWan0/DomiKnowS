version: v1.0
name: Relational Graph
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804
blocks:
  - name: "Unit tests"
    task:
      prologue:
        commands:
          # Add --local pip bin to $PATH
          - export PATH=$HOME/.local/bin:$PATH
          - checkout
          - mkdir .pip_cache
          - cache restore pip-$SEMAPHORE_GIT_BRANCH-$(checksum requirements.txt),pip-$SEMAPHORE_GIT_BRANCH,pip-master
          # Use --user to avoid permission conflicts
          - if [ -e requirements-dev.txt ]; then pip install --user --cache-dir .pip_cache -r requirements-dev.txt; fi
          - if [ -e requirements.txt ]; then pip install --user --cache-dir .pip_cache -r requirements.txt; fi
          - cache store pip-$SEMAPHORE_GIT_BRANCH-$(checksum requirements.txt) .pip_cache
          - export PYTHONPATH=.:$PYTHONPATH
      jobs:
      - name: pytest
        commands:
          - pytest test_regr -m "not gurobi"
